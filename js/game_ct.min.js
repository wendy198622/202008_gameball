function Vgg(){this.key=0}const vector_vgg=new Vgg;$((function(){set_content(),$(".vgg-copy-code").click(vgg_copy_code_handler),$(".vgg-retry").click(vgg_retry_handler),$(".vgg-pop-close").click(vgg_pop_close_handler),$("[class^='vgg-share']").click(vgg_sns_share_btn_handler),check_overdue(),check_over_limit()}));var currentDate=new Date,expirationDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()+1,0,0,0);function set_count(){var _count=get_count();_count++,$.cookie("count_"+vgg.pathname,_count,{expires:expirationDate})}function get_count(){var _count=$.cookie("count_"+vgg.pathname);return _count||$.cookie("count_"+vgg.pathname,0,{expires:expirationDate}),_count}function time_check(){var NOWYEAR=moment().format("YYYY"),NOWMONTH=moment().format("MM"),NOWDATE=moment().format("DD"),NOWHOUR=moment().format("HH"),NOWMIN=moment().format("mm"),AAA=moment([NOWYEAR,NOWMONTH,NOWDATE,NOWHOUR,NOWMIN]),NOW=moment(),BBB=moment(vgg.end_date),FINALCOUNT;return parseInt(NOW-BBB)>0}function count_check(){var _count=get_count(),remaining=vgg.total_of_day-_count;return remaining>0?remaining:0}function get_random(){return Math.floor(100*Math.random()+1)}function do_lottery(){var num=get_random(),key=vgg.lottery[num];vector_vgg.key=key;var result=vgg.result=vgg.gifts[key];return check_overdue(),check_over_limit(),set_content(),!vgg.disable&&result}function show_result(){if(!vgg.disable){var result=vgg.result;$(".vgg-promo-title").text(result.title),$(".vgg-promo-code").text(result.code),$(".vgg-promo-link").attr("href",result.link),$(".vgg-pop-"+result.type).fadeIn(300),set_count()}}function set_content(){set_sns_link(),$(".vgg-end-link").attr("href",vgg.end_link),$(".vgg-msg-overdue").html("每日限玩"+vgg.total_of_day+"次<br/>下次請早喔")}function set_sns_link(){var url=window.location.href,share_fb="http://www.facebook.com/sharer.php";$(".vgg-share-fb").data("url",share_fb+"?u="+url);var share_line="http://line.naver.jp/R/msg/text/";$(".vgg-share-line").data("url",share_line+"?"+url)}function check_overdue(){return time_check()&&($(".vgg-pop-overdue").fadeIn(300),vgg.disable=!0),vgg.disable}function check_over_limit(){var remaining=count_check();return remaining>0?$(".vgg-msg-counter").html("還剩"+(remaining-1)+"次機會"):($(".vgg-msg-counter").html("每日限玩"+vgg.total_of_day+"次<br/>下次請早喔"),$(".vgg-pop-over-limit").fadeIn(300),vgg.disable=!0),vgg.disable}function vgg_copy_code_handler(e){e.preventDefault();var name=$(this).attr("name"),el=document.getElementById(name),range=document.createRange();range.selectNodeContents(el);var sel=window.getSelection();return sel.removeAllRanges(),sel.addRange(range),document.execCommand("copy"),$(".copyouter").fadeIn(300).delay(800).fadeOut(300),window.getSelection().removeAllRanges(),!1}function vgg_retry_handler(e){e.preventDefault(),location.reload()}function vgg_pop_close_handler(e){e.preventDefault(),$(this).closest('div[class^="vgg-pop-"]').fadeOut(300)}function vgg_sns_share_btn_handler(e){var url=$(this).data("url");url&&window.open(url,"_blank")}